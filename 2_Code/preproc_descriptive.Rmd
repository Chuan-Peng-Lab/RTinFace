---
title: "Preprocessing & Descriptive Analysis"
author: "hcp4715"
date: '2024-09-95'
output: html_document
---

```{r}
# install pacman if not installed yet
if (!require("pacman")) install.packages("pacman")

# use pacman::p_load to load or install tidyverse
pacman::p_load(tidyverse)
```
Load the data.
```{r}
df_full <- read.csv(here::here("2_Code", "data", "rt_tidy.csv"))
regions <- read.csv(here::here("1_data", "Preprocessed", "regions.csv"))
```

Add region information to the data
```{r}
df_regions <- df_full %>% 
  dplyr::mutate(lab  = substr(lab, 1, nchar(lab)- 4)) %>% 
  dplyr::mutate(country = lab) %>% 
  dplyr::left_join(regions, by = "country")
```

Get language information
```{r}
languages <- df_full %>% 
  dplyr::group_by(language) %>% 
  dplyr::summarise(N=n())

# quick check the language information
languages %>%
  ggplot(aes(x=reorder(language, N), y=N, fill=N)) +
  geom_col() +
  coord_flip() +
  theme_minimal()
```
Quick check traits that used for rating
```{r}
traits <- df_full %>% 
  group_by(trait) %>% 
  summarise(N=n())

traits %>% 
  ggplot(aes(x=reorder(trait,N),y=N,fill=N))+
  geom_col()+
  coord_flip()+
  theme_minimal()
```

Quick check for the country info
```{r}
country <- df_full %>% 
  group_by(country) %>% 
  summarise(N=n())

country %>% 
  filter(country != "NA") %>% 
  filter(N > 200) %>%
  ggplot(aes(x = reorder(country,N),y=N,fill=N))+
           geom_col()+
           coord_flip()+
           theme_minimal()
           
```
quick check the ethnicity info, need further cleaning
```{r}
ethnicity_participants <- df_full %>% 
  group_by(ethnicity.x) %>% 
  summarise(N=n())

ethnicity_participants %>%
  filter(N>500) %>% 
  filter(ethnicity.x!="NA") %>% 
  ggplot(aes(x = reorder(ethnicity.x,N),y=N,fill=N))+
           geom_col()+
           coord_flip()+
           theme_minimal()
```
quick check the race info of stimuli

A(), B(), L(), W() ?

```{r}
race <- df_full %>% 
  group_by(Race) %>% 
  summarise(N=n())

race %>% 
  ggplot(aes(x=reorder(Race,N),y=N,fill=N))+
  geom_col()+
  coord_flip()+
  theme_minimal()
```

quick check the ethnicity info of stimuli

A(Asian), B(black), L(Latin), W(White) ?

```{r}
ethnicity_face <- df_full %>% 
  group_by(ethnicity.y) %>% 
  summarise(N=n())
  
ethnicity_face %>% 
  ggplot(aes(x=reorder(ethnicity.y,N),y=N,fill=N))+
  geom_col()+
  coord_flip()+
  theme_minimal()

```
```{r}
gender_face <- df_full %>% 
  group_by(gender) %>% 
  summarise(N=n())

gender_face %>% 
  ggplot(aes(x=reorder(gender,N),y=N,fill=N))+
  geom_col()+
  coord_flip()+
  theme_minimal()
```

### 不同性别的评分和反应时
```{r}
df_full %>% 
  ggplot(aes(rating, fill = trait)) +
    geom_histogram() +
    facet_grid(gender~trait, space = "free")
    #scale_x_continuous(breaks = c(2000,3000))

#df_full %>% 
  #ggplot(aes(x=rt,y=rt,fill=trait))+
  #geom_point()+
  #facet_grid(gender~trait,space = "free")
```

```{r}
attractive_data <- df_full %>% 
  filter(trait == "attractive")
```

```{r warning=FALSE}
df_full %>% 
  mutate(rating = as.numeric(rating)) %>% 
  mutate(trait = as.factor(trait)) %>% 
  mutate(country = as.factor(country)) %>% 
  drop_na(country) %>% 
  filter(country != "--") %>% 
  ggplot(aes(x=rating,color = country, fill = country))+
  facet_wrap(~country)+
  geom_density()+
  theme_classic()
```

#density plot for rating distribution across different traits
```{r}
df_full %>% 
  mutate(rating = as.numeric(rating)) %>% 
  mutate(trait = as.factor(trait)) %>% 
  ggplot(aes(x=rating,color = trait, fill = trait))+
  facet_wrap(~trait, 2)+
  geom_bar()+
  theme_classic()+
  ggtitle("Figure 2. Density plot for rating distribution across different traits")
```

```{r}
region <- df_full %>% 
  select(lab) %>%
  mutate(lab  = substr(lab,1,nchar(lab)-4)) %>% 
  mutate(country = lab) %>% 
  group_by(country) %>% 
  count(name = "number") %>% 
  ungroup() %>% 
  left_join(regions, by = "country") %>% 
  ggplot(., aes(x = number, y = region, fill = country)) +
  geom_bar(stat = "identity", position = "stack") + 
  labs(title = "Fig.1 Participant Demographics", x = "Count", y = "Region") +
  theme_minimal()
region

```


```{r}
df_regions %>% 
  ggplot(aes(x = ))
```

```{r}
df_full %>% 
  mutate(rating = as.numeric(rating)) %>% 
  mutate(trait = as.factor(trait)) %>% 
  ggplot(aes(x=rt,color = trait, fill = trait))+
  facet_wrap(~trait, 2)+
  geom_density()+
  theme_classic()+
  ggtitle("Figure 2. Density plot for reaction time distribution across different traits")
```